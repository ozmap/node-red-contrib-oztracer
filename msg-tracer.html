<style>

    /*Selected step in tracer*/
    .msg-tracer-line-selected {
        background-color: lightblue;
    }
    .msg-tracer-line {

    }

    .toggle-bp-button {
        border-width: thick;
        border-radius: 25%;
        color: red;
        background-color: darkred;
    }
</style>

<script type="text/javascript">

    $(()=>{
        const noderedAdminUrl = window.location.href.split('#')[0];
        let content = `
            <div id="tracer-tabs">
                <h4>Configurações do sistema:</h4>
                <div>
                    <br/>
                    EndPoint:<input id="url-end-point"><br/>
                    ServiceName:<input id="service-name"><br/><br/>
                    <button id="save-button">Salvar</button>
                </div>
              

            </div>

            <style>
       
            </style>
`;

        content = $(content);

        // Adding the tracer tab to the sidebar
        RED.sidebar.addTab({
            id: "msg-tracer",
            label: 'OZTracer',
            name: 'OZTracer',
            iconClass: "fa fa-random",
            content: content,
            pinned: true,
            enableOnEdit: true
        });

        let config = {};
        let serviceName = $("#service-name");
        let urlEndPoint = $("#url-end-point");
        let saveButton = $("#save-button");

        RED.comms.subscribe("oztracer/config", function (topic, cfg) {
            serviceName.val(cfg.serviceName);
            urlEndPoint.val(cfg.url);
        });

       
        saveButton.on('click', function () {
            const putConfig = {
                serviceName: serviceName.val(),
                urlEndPoint: urlEndPoint.val()
            };

            $.ajax({
                url: 'oztracer/config',
                contentType: "application/json",
                dataType:'json',
                data: JSON.stringify(putConfig),
                type: 'PUT',
                error: function() {
                    console.error(`Failed to change trace state`);
                },
                success: function() {
                    
                }
            });
        });
    })
</script>
